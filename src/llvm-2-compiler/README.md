# Минимальный компилятор, основанный на LLVM

Ранее в примере `llvm-1-ir-translator` был представлен транслятор, который транслирует высокоуровневый язык в LLVM-IR, близкий к ассемблеру. Однако, это трудно считать нормальным компилятором: мы всё ещё должны были вызывать `llc` или `clang` для компиляции LLVM-IR файла.

В данном примере добавлена генерация объектного файла `program.o` под целевую платформу, на которой запущен сам компилятор. Компилятор не обязан брать на себя функции компоновщика объектных файлов, поэтому мы не реализуем в компиляторе возможность создания исполняемого файла, а всего лишь генерируем совместимый с C/C++ объектный файл.

##### Ввод
```
def main()
  x = 2 + 34 / 2
  print x - 4 * 0.5
end
```

##### После вывода
```bash
>gcc program.o -o program
>./program
17.000000
```

Здесь сборка идёт через `gcc`, потому что для сборки через `ld` потребуется ряд дополнительных параметров &mdash; см. [вопрос на stackoverflow.com](http://stackoverflow.com/questions/3577922/how-to-link-a-gas-assembly-program-that-uses-the-c-standard-library-with-ld-with)

### Изменения в сравнении с llvm-1-translator

- Новый класс `CCompilerBackend` с единственным методом `GenerateObjectFile` реализует генерацию объектного файла под целевую платформу на основе модуля LLVM-IR кода.
- Для разработки класса были использованы исходники утилиты `llc` из состава `LLVM` версии 3.8. В сравнении с оригиналом, код значительно упрощён &mdash; убрана обработка различных опций командной строки.

### Системные требования

- Рекомендуются LLVM версии 3.8, lemon произвольной версии
- Для ОС Ubuntu: установите пакеты `lemon`, `clang`, `llvm-dev`, `cmake`
- Для ОС Windows: установите CMake, [загрузите и установите Clang](http://llvm.org/releases/download.html), соберите Lemon из [исходных кодов (hwaci.com)](http://www.hwaci.com/sw/lemon/), соберите библиотеки LLVM из исходников с помощью CMake.
